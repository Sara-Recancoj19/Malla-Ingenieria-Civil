<!doctype html>
<html lang="es">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Malla Curricular – Ingeniería Civil</title>

<style>
:root{
  --approved:#e53935;
  --available:#ffd6d6;
  --locked:#9a9a9a;
  --accent:#2b6cb0;
  --obligatorio:#fbc02d;
}

body{
  font-family:system-ui, Arial;
  margin:16px;
  background:#f7fafc;
}

header{
  display:flex;
  justify-content:space-between;
  align-items:center;
  flex-wrap:wrap;
  gap:12px;
}

h1{font-size:18px;margin:0}

.counter{
  background:#fff;
  padding:10px 14px;
  border-radius:10px;
  box-shadow:0 4px 10px rgba(0,0,0,.08);
}

.counter strong{
  font-size:18px;
  color:var(--accent);
}

.grid{
  margin-top:20px;
  display:flex;
  gap:12px;
  overflow-x:auto;
}

.sem{
  min-width:240px;
  background:#fff;
  border-radius:10px;
  padding:10px;
  box-shadow:0 4px 10px rgba(0,0,0,.06);
}

.sem h3{
  text-align:center;
  font-size:14px;
  margin:6px 0 10px;
}

.course{
  padding:8px;
  border-radius:8px;
  margin-bottom:8px;
  font-size:13px;
  cursor:pointer;
}

.aprobado{background:var(--approved);color:white}
.disponible{background:var(--available);color:#7a1c1c}
.bloqueado{background:var(--locked);color:white;cursor:not-allowed}

.meta{
  font-size:11px;
  display:flex;
  justify-content:space-between;
  margin-top:4px;
}

.badge{
  background:var(--obligatorio);
  color:#000;
  font-size:10px;
  padding:2px 6px;
  border-radius:6px;
  font-weight:600;
}
</style>
</head>

<body>

<header>
  <h1>Malla Curricular Interactiva – Ingeniería Civil</h1>
  <div class="counter">
    Créditos aprobados:
    <strong><span id="creditos">0</span></strong>
    /
    <strong><span id="total">0</span></strong>
  </div>
</header>

<div class="grid" id="grid"></div>

<script>
/* ================= CURSOS ================= */
const cursos = [
  {"codigo":"3005","nombre":"Técnicas de Estudio e Investigación","creditos":3,"prereq":[],"semestre":1},
  {"codigo":"3003","nombre":"Área Social Humanística 1","creditos":3,"prereq":[],"semestre":1},
  {"codigo":"3000","nombre":"Área Matemática Básica 1","creditos":9,"prereq":[],"semestre":1},
  {"codigo":"3001","nombre":"Química General 1","creditos":7,"prereq":[],"semestre":1},
  {"codigo":"3004","nombre":"Área Técnica Complementaria 1","creditos":4,"prereq":[],"semestre":1},
  {"codigo":"3082","nombre":"Deportes 1","creditos":2,"prereq":[],"semestre":1},

  {"codigo":"3011","nombre":"Área Social Humanística 2","creditos":3,"prereq":["3003"],"semestre":2},
  {"codigo":"3006","nombre":"Matemática Básica 2","creditos":9,"prereq":["3000"],"semestre":2},
  {"codigo":"3007","nombre":"Física Básica","creditos":5,"prereq":["3000"],"semestre":2},
  {"codigo":"3161","nombre":"Química para Ingeniería Civil","creditos":6,"prereq":["3001","3000"],"semestre":2},
  {"codigo":"3162","nombre":"Dibujo Costructivo para Ingeniería","creditos":6,"prereq":["3004"],"semestre":2},

  {"codigo":"3013","nombre":"Área Matemática Intermedia 1","creditos":9,"prereq":["3006"],"semestre":3},
  {"codigo":"3014","nombre":"Física 1","creditos":5,"prereq":["3006","3007"],"semestre":3},
  {"codigo":"3163","nombre":"Ecología","creditos":4,"prereq":["3161"],"semestre":3},
  {"codigo":"3164","nombre":"Prácticas Iniciales","creditos":0,"prereq":["3006","3162","3007"],"semestre":3}
];

/* ===== TOTAL DE CRÉDITOS ===== */
const totalPensum = cursos.reduce((s,c)=>s + c.creditos, 0);
document.getElementById("total").textContent = totalPensum;

/* ============ MEMORIA ============ */
const STORAGE_KEY = "malla_civil_aprobados";
let aprobados = new Set(JSON.parse(localStorage.getItem(STORAGE_KEY) || "[]"));

/* ============ FUNCIONES ============ */
function puedeLlevar(curso){
  return curso.prereq.every(p => aprobados.has(p));
}

function render(){
  const grid = document.getElementById("grid");
  grid.innerHTML = "";

  const semestres = [...new Set(cursos.map(c=>c.semestre))].sort((a,b)=>a-b);
  let creditosAprobados = 0;

  semestres.forEach(sem=>{
    const col = document.createElement("div");
    col.className = "sem";
    col.innerHTML = `<h3>Semestre ${sem}</h3>`;

    cursos.filter(c=>c.semestre===sem).forEach(c=>{
      let estado = "bloqueado";
      if (aprobados.has(c.codigo)) estado = "aprobado";
      else if (puedeLlevar(c)) estado = "disponible";

      const div = document.createElement("div");
      div.className = `course ${estado}`;
      div.innerHTML = `
        <strong>${c.codigo}</strong> ${c.nombre}
        <div class="meta">
          <span>${c.creditos} cr</span>
          <span class="badge">⭐ Obligatorio</span>
        </div>
        <div class="meta">
          <span>${c.prereq.length ? "Req: "+c.prereq.join(", ") : ""}</span>
        </div>
      `;

      if (estado !== "bloqueado") {
        div.onclick = () => {
          aprobados.has(c.codigo)
            ? aprobados.delete(c.codigo)
            : aprobados.add(c.codigo);
          localStorage.setItem(STORAGE_KEY, JSON.stringify([...aprobados]));
          render();
        };
      }

      if (aprobados.has(c.codigo)) creditosAprobados += c.creditos;
      col.appendChild(div);
    });

    grid.appendChild(col);
  });

  document.getElementById("creditos").textContent = creditosAprobados;
}

render();
</script>

</body>
</html>
